<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Модальное окно с вертикальной разделяющей полосой</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>

    <img src="https://www.newstaff.ru/2023/11/17/1521655b9e77ea3f390b41f5ec89f3f10a67cb59.jpg" alt="" class="image1">
    <img src="https://i2.wp.com/miro.medium.com/1*29NeeIGT0BElEBNfzE_VlQ.jpeg" alt="" class="image2">

    <!--ЦЕНТРАЛЬНО ОКНО-->
    <div class="container">
        <h1>Что-то странное</h1>
        <button class="button" id="addPair">Добавить пару</button>
        <button class="button" id="deletePair">Удалить пару</button>
        <button class="button" id="replacePair">Изменить пару</button>
        <button class="button" id="openLinkButton">Гугл календарь</button>
        <button class="button" id="occupancy">Занятость кабинета</button>
        <button class="button" id="sync">Синхронизировать гугл календарь с базой данных</button>

        <!--Занятость кабинета-->
        <div id="myModal3" class="modal">
            <div class="modal-content">
                <span class="close" id="closeOccupancy">&times;</span>
                <p style="font-size: 20px;">Занятость кабинета</p>
                <form id="modalForm">
                    <label for="time">Время начала:</label>
                    <input type="time" id="start-time" name="start-time" required>
                    <label for="end-time">Время конца:</label>
                    <input type="time" id="end-time" name="end-time" required>
                    <label for="room">Кабинет:</label>
                    <select id="room" name="room" required>
                        <option value="it-1">it-1</option>
                        <option value="it-2">it-2</option>
                        <option value="it-3">it-3</option>
                        <option value="it-4">it-4</option>
                        <option value="it-5">it-5</option>
                        <option value="it-6">it-6</option>
                        <option value="it-7">it-7</option>
                        <option value="it-8">it-8</option>
                        <option value="it-9">it-9</option>
                        <option value="it-10">it-10</option>
                        <option value="it-11">it-11</option>
                        <option value="it-12">it-12</option>
                        <option value="it-13">it-13</option>
                        <option value="it-14">it-14</option>
                        <option value="it-15">it-15</option>
                        <option value="it-16">it-16</option>
                        <option value="it-17">it-17</option>
                        <option value="320">320</option>
                        <option value="322">322</option>
                    </select>
                    <label for="date">Выбор даты:</label>
                    <input type="date" id="date" name="date" required>
                    <button type="submit" class="sendbutton">Отправить</button>
                </form>
            </div>
        </div>

        <!-- Модальное окно для "ДОБАВЛЕНИЯ ПАРЫ" -->
        <div id="myModal1" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModalAdd">&times;</span>
                <p style="font-size: 20px;">Добавление пары</p>

                <form id="modalForm">
                    <label for="teacher">Фамилия преподователя:</label>
                    <input type="text" id="teacher" name="teacher" required>
                    <label for="subject">Предмет:</label>
                    <input type="text" id="subject" name="subject" required>
                    <label for="subject">Группа:</label>
                    <input type="text" id="group" name="group" required>
                    <label for="time">Время начала:</label>
                    <input type="time" id="start-time" name="start-time" required>
                    <label for="end-time">Время конца:</label>
                    <input type="time" id="end-time" name="end-time" required>
                    <label for="room">Кабинет:</label>
                    <select id="room" name="room" required>
                        <option value="it-1">it-1</option>
                        <option value="it-2">it-2</option>
                        <option value="it-3">it-3</option>
                        <option value="it-4">it-4</option>
                        <option value="it-5">it-5</option>
                        <option value="it-6">it-6</option>
                        <option value="it-7">it-7</option>
                        <option value="it-8">it-8</option>
                        <option value="it-9">it-9</option>
                        <option value="it-10">it-10</option>
                        <option value="it-11">it-11</option>
                        <option value="it-12">it-12</option>
                        <option value="it-13">it-13</option>
                        <option value="it-14">it-14</option>
                        <option value="it-15">it-15</option>
                        <option value="it-16">it-16</option>
                        <option value="it-17">it-17</option>
                        <option value="320">320</option>
                        <option value="322">322</option>
                    </select>
                    <label for="date">Выбор даты:</label>
                    <input type="date" id="date" name="date" required>
                    <label for="type">Выбор типа:</label>
                    <select name="type" id="type" required>
                        <option value="one_time">Одноразовый</option>
                        <option value="every_week">Еженедельный</option>
                    </select>
                    <button type="submit" class="sendbutton">Отправить</button>
                </form>
            </div>
        </div>

        <!--Модальное окно для "УДАЛЕНИЯ ПАРЫ"-->
        <div id="myModal2" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModalDel">&times;</span>
                <p style="font-size: 20px;">Удаление пары</p>

                <form id="modalForm">
                    <label for="teacher">Фамилия преподователя:</label>
                    <input type="text" id="teacher" name="teacher" required>
                    <label for="subject">Предмет:</label>
                    <input type="text" id="subject" name="subject" required>
                    <label for="subject">Группа:</label>
                    <input type="text" id="group" name="group" required>
                    <label for="time">Время начала:</label>
                    <input type="time" id="start-time" name="start-time" required>
                    <label for="end-time">Время конца:</label>
                    <input type="time" id="end-time" name="end-time" required>
                    <label for="room">Кабинет:</label>
                    <select name="room" id="room" required>
                        <option value="it-1">it-1</option>
                        <option value="it-2">it-2</option>
                        <option value="it-3">it-3</option>
                        <option value="it-4">it-4</option>
                        <option value="it-5">it-5</option>
                        <option value="it-6">it-6</option>
                        <option value="it-7">it-7</option>
                        <option value="it-8">it-8</option>
                        <option value="it-9">it-9</option>
                        <option value="it-10">it-10</option>
                        <option value="it-11">it-11</option>
                        <option value="it-12">it-12</option>
                        <option value="it-13">it-13</option>
                        <option value="it-14">it-14</option>
                        <option value="it-15">it-15</option>
                        <option value="it-16">it-16</option>
                        <option value="it-17">it-17</option>
                        <option value="320">320</option>
                        <option value="322">322</option>
                    </select>
                    <label for="date">Выбор даты:</label>
                    <input type="date" id="date" name="date" required>
                    <label for="del">Сколько пар удалить:</label>
                    <select name="del" id="del" required>
                        <option value="one">одну</option>
                        <option value="all">все</option>
                    </select>
                    <button type="submit" class="sendbutton">Отправить</button>
                </form>
            </div>
        </div>

        <!-- МОДАЛЬНОЕ ОКНО ДЛЯ ИЗМЕНЕНИЯ ПАРЫ-->
        <div id="modal3" class="modal">
            <div class="modal-content1">
                <span class="close" id="closeReplace">&times;</span>
                <div class="left-section">
                    <p style="font-size: 20px;">На что меняем</p>
                    <form id="modalForm">
                        <label for="teacher">Фамилия преподователя:</label>
                        <input type="text" id="teacher" name="teacher" required>
                        <label for="subject">Предмет:</label>
                        <input type="text" id="subject" name="subject" required>
                        <label for="subject">Группа:</label>
                        <input type="text" id="group" name="group" required>
                        <label for="time">Время начала:</label>
                        <input type="time" id="start-time" name="start-time" required>
                        <label for="end-time">Время конца:</label>
                        <input type="time" id="end-time" name="end-time" required>
                        <label for="room">Кабинет:</label>
                        <select id="room" name="room" required>
                            <option value="it-1">it-1</option>
                            <option value="it-2">it-2</option>
                            <option value="it-3">it-3</option>
                            <option value="it-4">it-4</option>
                            <option value="it-5">it-5</option>
                            <option value="it-6">it-6</option>
                            <option value="it-7">it-7</option>
                            <option value="it-8">it-8</option>
                            <option value="it-9">it-9</option>
                            <option value="it-10">it-10</option>
                            <option value="it-11">it-11</option>
                            <option value="it-12">it-12</option>
                            <option value="it-13">it-13</option>
                            <option value="it-14">it-14</option>
                            <option value="it-15">it-15</option>
                            <option value="it-16">it-16</option>
                            <option value="it-17">it-17</option>
                            <option value="320">320</option>
                            <option value="322">322</option>
                        </select>
                        <label for="date">Выбор даты:</label>
                        <input type="date" id="date" name="date" required>
                        <label for="type">Выбор типа:</label>
                        <select name="type" id="type" required>
                            <option value="one_time">Одноразовый</option>
                            <option value="every_week">Еженедельный</option>
                        </select>
                    </form>
                </div>

                <div class="right-section">
                    <p style="font-size: 20px;">Что меняем</p>
                    <form id="modalForm">
                        <label for="teacher">Фамилия преподователя:</label>
                        <input type="text" id="teacher" name="teacher" value="" required>
                        <label for="subject">Предмет:</label>
                        <input type="text" id="subject" name="subject" required>
                        <label for="subject">Группа:</label>
                        <input type="text" id="group" name="group" required>
                        <label for="time">Время начала:</label>
                        <input type="time" id="start-time" name="start-time" required>
                        <label for="end-time">Время конца:</label>
                        <input type="time" id="end-time" name="end-time" required>
                        <label for="room">Кабинет:</label>
                        <select name="room" id="room" required>
                            <option value="it-1">it-1</option>
                            <option value="it-2">it-2</option>
                            <option value="it-3">it-3</option>
                            <option value="it-4">it-4</option>
                            <option value="it-5">it-5</option>
                            <option value="it-6">it-6</option>
                            <option value="it-7">it-7</option>
                            <option value="it-8">it-8</option>
                            <option value="it-9">it-9</option>
                            <option value="it-10">it-10</option>
                            <option value="it-11">it-11</option>
                            <option value="it-12">it-12</option>
                            <option value="it-13">it-13</option>
                            <option value="it-14">it-14</option>
                            <option value="it-15">it-15</option>
                            <option value="it-16">it-16</option>
                            <option value="it-17">it-17</option>
                            <option value="320">320</option>
                            <option value="322">322</option>
                        </select>
                        <label for="date">Выбор даты:</label>
                        <input type="date" id="date" name="date" required>
                        <label for="del">Сколько пар удалить:</label>
                        <select name="del" id="del" required>
                            <option value="one">одну</option>
                            <option value="all">все</option>
                        </select>
                    </form>
                </div>
                <button type="submit" id="replace-pair-btn" class="sendbutton">Отправить</button>
            </div>
        </div>
    </div>

    <script>
        function open_mw_add_pair() {
            modal1.style.display = 'block';
            let form = document.querySelector("#myModal1 > div > form");
            var submit_btn = form.querySelector(".sendbutton")
            submit_btn.onclick = function () {
                var teacher = form.querySelector("#teacher");
                var subject = form.querySelector("#subject");
                var group = form.querySelector("#group");
                var start_time = form.querySelector("#start-time");
                var end_time = form.querySelector("#end-time");
                var cab = form.querySelector("#room");
                var date = form.querySelector("#date");
                var type = form.querySelector("#type");

                const response = fetch("/add_pair", {
                    method: "PUT",
                    body: JSON.stringify({
                        teacher: teacher.value,
                        subject: subject.value,
                        cabinet: cab.value,
                        start_time: start_time.value,
                        end_time: end_time.value,
                        group: group.value,
                        date: date.value,
                        type: type.value
                    })
                })
            }
        }

        function close_mw_add_pair() {
            modal1.style.display = 'none';
        }

        function open_mw_delete_pair() {
            modal2.style.display = 'block';
            let form = document.querySelector("#myModal2 > div > form");
            var submit_btn = form.querySelector(".sendbutton")
            submit_btn.onclick = function () {
                var teacher = form.querySelector("#teacher");
                var subject = form.querySelector("#subject");
                var group = form.querySelector("#group");
                var start_time = form.querySelector("#start-time");
                var end_time = form.querySelector("#end-time");
                var cab = form.querySelector("#room");
                var date = form.querySelector("#date");
                var del = form.querySelector("#del");

                const response = fetch("/delete_pair", {
                    method: "PUT",
                    body: JSON.stringify({
                        teacher: teacher.value,
                        subject: subject.value,
                        cabinet: cab.value,
                        start_time: start_time.value,
                        end_time: end_time.value,
                        group: group.value,
                        date: date.value,
                        deletion_type: del.value
                    })
                })
            }
        }

        function close_mw_delete_pair() {
            modal2.style.display = 'none';
        }

        function open_mw_replace_pair() {
            modal3.style.display = 'block';
            let form1 = modal3.querySelector("div + div").querySelector("div > form");
            let form2 = modal3.querySelector("div > div > form");
            
            var submit_btn = modal3.querySelector("div > .sendbutton")
            submit_btn.onclick = function () {
                //получаем инфу о том, что удаляем
                var teacher1 = form1.querySelector("#teacher");
                var subject1 = form1.querySelector("#subject");
                var group1 = form1.querySelector("#group");
                var start_time1 = form1.querySelector("#start-time");
                var end_time1 = form1.querySelector("#end-time");
                var cab1 = form1.querySelector("#room");
                var date1 = form1.querySelector("#date");
                var del = form1.querySelector("#del");

                //получаем инфу о том, что добавляем
                var teacher2 = form2.querySelector("#teacher");
                var subject2 = form2.querySelector("#subject");
                var group2 = form2.querySelector("#group");
                var start_time2 = form2.querySelector("#start-time");
                var end_time2 = form2.querySelector("#end-time");
                var cab2 = form2.querySelector("#room");
                var date2 = form2.querySelector("#date");
                var type = form2.querySelector("#type");

                const response = fetch("/replace_pair", {
                    method: "PUT",
                    body: JSON.stringify({
                        teacher_before: teacher1.value,
                        subject_before: subject1.value,
                        cabinet_before: cab1.value,
                        start_time_before: start_time1.value,
                        end_time_before: end_time1.value,
                        group_before: group1.value,
                        date_before: date1.value,
                        deletion_type: del.value,

                        teacher_after: teacher2.value,
                        subject_after: subject2.value,
                        cabinet_after: cab2.value,
                        start_time_after: start_time2.value,
                        end_time_after: end_time2.value,
                        group_after: group2.value,
                        date_after: date2.value,
                        type: type.value
                    })
                })
            }
        }

        function close_mw_replace_pair() {
            modal3.style.display = 'none';
        }

        function open_mw_get_occup() {
            modal4.style.display = 'block';
            let form = modal4.querySelector("div > form");
            var submit_btn = form.querySelector(".sendbutton")
            console.log(submit_btn.textContent);
            submit_btn.onclick = function () {
                var start_time = form.querySelector("#start-time");
                var end_time = form.querySelector("#end-time");
                var cab = form.querySelector("#room");
                var date = form.querySelector("#date")

                const response = fetch("/get_occup", {
                    method: "PUT",
                    body: JSON.stringify({
                        cabinet: cab.value,
                        start_time: start_time.value,
                        end_time: end_time.value,
                        date: date.value
                    }),
                })
                console.log('s');
                response.then(function (value) {
                    if (value.headers.get('result') == "True") {
                        alert("Кабинет занят");
                    } else {
                        alert("Кабинет свободен");
                    }
                });                
            }
        }

        function close_mw_get_occup() {
            modal4.style.display = 'none';
        }

        // Для добавления пары
        var modal1 = document.getElementById("myModal1");
        var add = document.getElementById('addPair');
        var span1 = document.getElementById('closeModalAdd');

        // Для удаления пары
        var modal2 = document.getElementById("myModal2");
        var del = document.getElementById('deletePair');
        var span2 = document.getElementById('closeModalDel');

        // Для замены пары
        var modal3 = document.getElementById('modal3');
        var replace = document.getElementById('replacePair');
        var span3 = document.getElementById('closeReplace');

        // Для занятости кабинета
        var modal4 = document.getElementById("myModal3");
        var occup = document.getElementById("occupancy");
        var span4 = document.getElementById("closeOccupancy");
        var close_replace_pair_btn = document.getElementById("replace-pair-btn");

        var sync_btn = document.getElementById("sync");
        sync_btn.addEventListener("click", function () {
            const response = fetch("/sync", {
                method: "PUT"
            })
        })

        add.addEventListener("click", open_mw_add_pair);
        span1.addEventListener("click", close_mw_add_pair);

        del.addEventListener("click", open_mw_delete_pair);
        span2.addEventListener("click", close_mw_delete_pair);

        replace.addEventListener("click", open_mw_replace_pair);
        span3.addEventListener("click", close_mw_replace_pair);
        close_replace_pair_btn.addEventListener("click", close_mw_replace_pair);

        occup.addEventListener("click", open_mw_get_occup);
        span4.addEventListener("click", close_mw_get_occup);
        
        document.getElementById("openLinkButton").onclick = function () {
            window.open("https://calendar.google.com/calendar/u/0?cid=ZjI1MzQ0ZTI2NDlkOTY3Yzc4NTY2YTA2MWEwNmZhZTY0OTBhMTYyYzlhN2I2NzhlNjFlNjE3MWYxZmFjMzdjMEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t");
        }

        window.onclick = function (event) {
            if (event.target == modal1) {
                modal1.style.display = 'none';
            } else if (event.target == modal2) {
                modal2.style.display = 'none';
            } else if (event.target == modal3) {
                modal3.style.display = 'none';
            } else if (event.target == modal4) {
                modal4.style.display = 'none';
            }
        }

    </script>

</body>
</html>
